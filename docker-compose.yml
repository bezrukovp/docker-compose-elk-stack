version: '2'
services:
  elk:
    build: elk
    restart: always
    ports:
      - "5601:5601"
      - "9201:9200"
      - "5044:5044"
      - "5000:5000"
    environment:
      LOGSTASH_FILTER_POSTFIX_TIMESTAMP_TIMEZONE: Europe/Moscow
    volumes:
      - ./elasticsearch/data:/var/lib/elasticsearch
  curator:
    build: curator
    restart: always
    links:
      - elk
  elastalert:
    build:
      context: elastalert
      args:
        setContainerTimezone: "true"
        containerTimezone: Europe/Moscow
    restart: always
    links:
      - elk:elasticsearch_host
    environment:
      SET_CONTAINER_TIMEZONE: "true"
      CONTAINER_TIMEZONE: Europe/Moscow
    volumes:
      - elastalert-config:/opt/config
      - elastalert-rules:/opt/rules
      - elastalert-logs:/opt/logs
volumes:
  elastalert-config:
    driver: local
  elastalert-rules:
    driver: local
  elastalert-logs:
    driver: local
